<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Petrol Expense Tracker</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f8f9fa; }
    header { background: #007bff; color: #fff; padding: 15px; text-align: center; }
    .container { max-width: 1000px; margin: 20px auto; padding: 20px; background: #fff; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    h1 { margin: 0; }
    h2 { margin-top: 20px; }
    .row { display: flex; flex-wrap: wrap; gap: 20px; margin-top: 15px; }
    .card { flex: 1; min-width: 280px; background: #fdfdfd; border: 1px solid #ddd; border-radius: 8px; padding: 15px; box-shadow: 0 1px 4px rgba(0,0,0,0.05); }
    label { display: block; margin: 8px 0 4px; font-weight: bold; }
    input { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 5px; }
    button { margin-top: 10px; padding: 8px 12px; border: none; border-radius: 5px; background: #007bff; color: #fff; cursor: pointer; }
    button:hover { background: #0056b3; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    table, th, td { border: 1px solid #ccc; }
    th, td { padding: 10px; text-align: center; }
    .over-budget { color: red; font-weight: bold; }
    .progress-bar { height: 22px; background: #e9ecef; border-radius: 11px; overflow: hidden; margin-top: 10px; }
    .progress { height: 100%; background: linear-gradient(90deg, #28a745, #218838); text-align: right; color: #fff; padding-right: 8px; font-size: 12px; line-height: 22px; }
    .actions { display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap; }
    .summary-list { list-style: none; padding: 0; margin: 0; }
    .summary-list li { margin: 6px 0; }
  </style>
</head>
<body>
  <header>
    <h1>Petrol Monthly Expense Tracker</h1>
  </header>

  <div class="container">
    <div class="row">
      <div class="card">
        <h2>Settings</h2>
        <label for="month">Select Month</label>
        <input type="month" id="month" />
        <label for="budget">Monthly Budget (RM)</label>
        <input type="number" id="budget" placeholder="Enter budget (RM)" />
        <button onclick="setBudget()">Set Budget</button>
      </div>

      <div class="card">
        <h2>Add Petrol Expense</h2>
        <label for="date">Date</label>
        <input type="date" id="date" required />
        <label for="amount">Total Amount (RM)</label>
        <input type="number" id="amount" step="0.01" />
        <label for="pricePerLitre">Price/Litre (RM)</label>
        <input type="number" id="pricePerLitre" step="0.01" />
        <label for="litres">Litres</label>
        <input type="number" id="litres" step="0.01" />
        <button onclick="addExpense()">Add Expense</button>
      </div>
    </div>

    <div class="card">
      <h2>Budget Status</h2>
      <div id="budgetStatus"></div>
      <div class="progress-bar"><div class="progress" id="progress"></div></div>
    </div>

    <div class="card">
      <h2>Summary</h2>
      <ul class="summary-list">
        <li id="summaryTotal">Total Spent: RM 0.00</li>
        <li id="summaryLitres">Total Litres: 0.00</li>
        <li id="summaryAverage">Average Price/Litre: RM 0.00</li>
      </ul>
    </div>

    <div class="card">
      <h2>Expense Records</h2>
      <table id="expenseTable">
        <thead>
          <tr>
            <th>Date</th>
            <th>Total Amount (RM)</th>
            <th>Price/Litre (RM)</th>
            <th>Litres</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div class="actions">
        <button onclick="exportCSV()">Export CSV</button>
        <button onclick="resetCurrentMonth()">Reset Current Month</button>
        <button onclick="resetAllData()">Reset All Data</button>
      </div>
    </div>
  </div>

  <script>
    let data = JSON.parse(localStorage.getItem('petrolData') || '{}');

    function getKey() {
      const month = document.getElementById('month').value;
      return month || new Date().toISOString().slice(0,7);
    }

    function setBudget() {
      const key = getKey();
      if (!data[key]) data[key] = { budget: 0, expenses: [] };
      data[key].budget = parseFloat(document.getElementById('budget').value) || 0;
      saveData();
      render();
    }

    function addExpense() {
      const key = getKey();
      if (!data[key]) data[key] = { budget: 0, expenses: [] };

      const date = document.getElementById('date').value;
      let amount = parseFloat(document.getElementById('amount').value) || 0;
      const pricePerLitre = parseFloat(document.getElementById('pricePerLitre').value) || 0;
      let litres = parseFloat(document.getElementById('litres').value) || 0;

      // Auto calculate litres or amount
      if (amount && pricePerLitre && !litres) {
        litres = amount / pricePerLitre;
      } else if (litres && pricePerLitre && !amount) {
        amount = litres * pricePerLitre;
      }

      if (!date || (!amount && !litres)) {
        alert("Please enter at least date and total amount or litres.");
        return;
      }

      data[key].expenses.push({ date, amount, pricePerLitre, litres });
      saveData();
      render();
      clearForm();
    }

    function clearForm() {
      document.getElementById('date').value = '';
      document.getElementById('amount').value = '';
      document.getElementById('pricePerLitre').value = '';
      document.getElementById('litres').value = '';
    }

    function deleteExpense(index) {
      const key = getKey();
      data[key].expenses.splice(index, 1);
      saveData();
      render();
    }

    function render() {
      const key = getKey();
      const tbody = document.querySelector('#expenseTable tbody');
      tbody.innerHTML = '';

      if (!data[key]) return;
      let total = 0, totalLitres = 0, priceSum = 0, priceCount = 0;

      data[key].expenses.forEach((exp, i) => {
        total += exp.amount;
        totalLitres += exp.litres || 0;
        if (exp.pricePerLitre) { priceSum += exp.pricePerLitre; priceCount++; }

        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${exp.date}</td>
          <td>${exp.amount.toFixed(2)}</td>
          <td>${exp.pricePerLitre ? exp.pricePerLitre.toFixed(2) : '-'}</td>
          <td>${exp.litres ? exp.litres.toFixed(2) : '-'}</td>
          <td><button onclick="deleteExpense(${i})">Delete</button></td>
        `;
        tbody.appendChild(tr);
      });

      const budget = data[key].budget || 0;
      const budgetStatus = document.getElementById('budgetStatus');
      budgetStatus.textContent = `Total Spent: RM ${total.toFixed(2)} / Budget: RM ${budget.toFixed(2)}`;
      if (total > budget && budget > 0) {
        budgetStatus.classList.add('over-budget');
      } else {
        budgetStatus.classList.remove('over-budget');
      }

      const percent = budget ? Math.min((total / budget) * 100, 100) : 0;
      document.getElementById('progress').style.width = percent + '%';
      document.getElementById('progress').textContent = budget ? Math.round(percent) + '%' : '';

      // Update summary
      document.getElementById('summaryTotal').textContent = `Total Spent: RM ${total.toFixed(2)}`;
      document.getElementById('summaryLitres').textContent = `Total Litres: ${totalLitres.toFixed(2)}`;
      document.getElementById('summaryAverage').textContent = `Average Price/Litre: RM ${(priceCount ? (priceSum/priceCount).toFixed(2) : '0.00')}`;
    }

    function saveData() {
      localStorage.setItem('petrolData', JSON.stringify(data));
    }

    function exportCSV() {
      const key = getKey();
      if (!data[key]) return;
      let csv = 'Date,Amount,PricePerLitre,Litres\n';
      data[key].expenses.forEach(exp => {
        csv += `${exp.date},${exp.amount},${exp.pricePerLitre || ''},${exp.litres || ''}\n`;
      });
      const blob = new Blob([csv], { type: 'text/csv' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `petrol_expenses_${key}.csv`; // filename includes month
      a.click();
    }

    function resetCurrentMonth() {
      const key = getKey();
      if (data[key] && confirm('Are you sure you want to reset this monthâ€™s data?')) {
        data[key] = { budget: 0, expenses: [] }; // clear budget & expenses
        saveData();
        document.getElementById('budget').value = ''; // clear input box
        render();
      }
    }

    function resetAllData() {
      if (confirm('Are you sure you want to reset ALL data?')) {
        data = {};
        saveData();
        document.getElementById('budget').value = '';
        render();
      }
    }

    // Auto-calculation for litres/amount when user types
    document.getElementById('amount').addEventListener('input', () => {
      const amount = parseFloat(document.getElementById('amount').value);
      const pricePerLitre = parseFloat(document.getElementById('pricePerLitre').value);
      if (amount && pricePerLitre) {
        document.getElementById('litres').value = (amount / pricePerLitre).toFixed(2);
      }
    });

    document.getElementById('litres').addEventListener('input', () => {
      const litres = parseFloat(document.getElementById('litres').value);
      const pricePerLitre = parseFloat(document.getElementById('pricePerLitre').value);
      if (litres && pricePerLitre) {
        document.getElementById('amount').value = (litres * pricePerLitre).toFixed(2);
      }
    });

    document.getElementById('pricePerLitre').addEventListener('input', () => {
      const amount = parseFloat(document.getElementById('amount').value);
      const litres = parseFloat(document.getElementById('litres').value);
      const pricePerLitre = parseFloat(document.getElementById('pricePerLitre').value);
      if (amount && pricePerLitre) {
        document.getElementById('litres').value = (amount / pricePerLitre).toFixed(2);
      } else if (litres && pricePerLitre) {
        document.getElementById('amount').value = (litres * pricePerLitre).toFixed(2);
      }
    });

    document.getElementById('month').value = new Date().toISOString().slice(0,7);
    render();
  </script>
</body>
</html>
